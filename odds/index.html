<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>API Data Display</title>
      <style>
         body {
         background-color: #212121;
         color: #f5f5f5;
         }
         table {
         border-collapse: collapse;
         width: 100%;
         margin-bottom: 20px;
         }
         th, td {
         border: 1px solid #616161;
         padding: 8px;
         text-align: left;
         }
         th {
         background-color: #424242;
         color: #39ff14;
         }
         .bookmaker-title {
         font-weight: bold;
         margin-bottom: 10px;
         }
         .sport-title {
         background-color: #424242;
         color: #39ff14;
         font-weight: bold;
         padding: 8px;
         position: sticky;
         top: 0;
         text-align: center;
         }
      </style>
   </head>
   <body>
      <div class="sport-title" id="sport-title">Basketball</div>
      <div id="bookmakers-container">
      </div>
      <script src="webMessageChannel.js"></script>
      <script>
     
         function onMessageReceived(message, port) {
             console.log("Received message from app:", message);
             let response = "Response from WebView: " + message;
             webMessageChannel.sendResponse(response, port);
             fetchApiData(message);
         }
         
         function clearBookmakersContainer() {
            const container = document.getElementById('bookmakers-container');
            while (container.firstChild) {
                container.removeChild(container.firstChild);
            }
         }
         
         function updateSportTitle(sportsTitle) {
         const sportTitle = document.getElementById('sport-title');
         let str = sportsTitle;
         let lowercaseStr = str.toLowerCase(); // "hello world"
         let capitalizedStr = str.charAt(0).toUpperCase() + str.slice(1); // "Hello World"
         sportTitle.textContent = capitalizedStr;
         }
         
         async function fetchApiData(sports) {
            clearBookmakersContainer();
        	  updateSportTitle(sports)
            const url = `https://api.the-odds-api.com/v4/sports/${sports}/odds/?apiKey=3a4a96544f6463e3f72df335653064ac&regions=us&markets=h2h,spreads,totals`;
            const response = await fetch(url);
            const apiData = await response.json();
            const container = document.getElementById('bookmakers-container');
         
         
            apiData.forEach(data => {
                data.bookmakers.forEach(bookmaker => {
                    const bookmakerTitle = document.createElement('div');
                    bookmakerTitle.className = 'bookmaker-title';
                    bookmakerTitle.textContent = bookmaker.title;
                    container.appendChild(bookmakerTitle);
         
                    const table = document.createElement('table');
                    container.appendChild(table);
         
                    const thead = document.createElement('thead');
                    table.appendChild(thead);
         
                    const headerRow = document.createElement('tr');
                    thead.appendChild(headerRow);
         
                    const headers = ['Name', 'H2H', 'Spreads', 'Totals'];
                    headers.forEach(headerText => {
                        const th = document.createElement('th');
                        th.textContent = headerText;
                        headerRow.appendChild(th);
                    });
         
                    const tbody = document.createElement('tbody');
                    table.appendChild(tbody);
         
                    const marketData = {};
         
                    bookmaker.markets.forEach(market => {
                        market.outcomes.forEach(outcome => {
                            if (!marketData[outcome.name]) {
                                marketData[outcome.name] = {
                                    h2h: null,
                                    spreads: null,
                                    totals: null
                                };
                            }
                            marketData[outcome.name][market.key] = {
                                price: outcome.price,
                                point: outcome.point
                            };
                        });
                    });
         
         Object.keys(marketData).forEach(name => {
         if (name !== 'Over' && name !== 'Under') {
         const tr = document.createElement('tr');
         tbody.appendChild(tr);
         
         const nameCell = document.createElement('td');
         nameCell.textContent = name;
         tr.appendChild(nameCell);
         
         ['h2h', 'spreads'].forEach(marketKey => {
            const marketCell = document.createElement('td');
         
            if (marketData[name][marketKey]) {
                const price = marketData[name][marketKey].price;
                const point = marketData[name][marketKey].point;
         
                marketCell.textContent = `Price: ${price}`;
                if (point) {
                    marketCell.textContent += `, Point: ${point}`;
                }
            } else {
                marketCell.textContent = '-';
            }
         
            tr.appendChild(marketCell);
         });
         
         const totalsCell = document.createElement('td');
         const overPrice = marketData['Over']['totals'].price;
         const overPoint = marketData['Over']['totals'].point;
         const underPrice = marketData['Under']['totals'].price;
         const underPoint = marketData['Under']['totals'].point;
         totalsCell.textContent = `Over (Price: ${overPrice}, Point: ${overPoint}), Under (Price: ${underPrice}, Point: ${underPoint})`;
         tr.appendChild(totalsCell);
         }
         });
                });
            });
         }
         
        let webMessageChannel = new WebMessageChannel(onMessageReceived);

         fetchApiData("Basketball");
      </script>
   </body>
</html>
